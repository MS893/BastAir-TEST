<% content_for :title, "Liste de tous les vols" %>

<div class="container my-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <%# Utilisation du titre dynamique %>
    <h1 class="mb-0"><%= @page_title %></h1>
    <%= link_to 'Retour au profil', user_path(current_user), class: 'btn btn-secondary' %>
  </div>

  <%# --- FORMULAIRE DE FILTRE --- %>
  <div class="card mb-4">
    <div class="card-body d-flex justify-content-between align-items-center">
      <%# Groupe de boutons à gauche %>
      <div class="btn-group" role="group">
        <%= link_to "Aujourd'hui", vols_path(period: 'day'), class: "btn #{params[:period] == 'day' ? 'btn-primary' : 'btn-outline-primary'}" %>
        <%= link_to "Cette semaine", vols_path(period: 'week'), class: "btn #{params[:period] == 'week' ? 'btn-primary' : 'btn-outline-primary'}" %>
        <%= link_to "Ce mois-ci", vols_path(period: 'month'), class: "btn #{params[:period] == 'month' ? 'btn-primary' : 'btn-outline-primary'}" %>
        <%= link_to "Cette année", vols_path(period: 'year'), class: "btn #{params[:period] == 'year' ? 'btn-primary' : 'btn-outline-primary'}" %>
        <%= link_to "Tout voir", vols_path, class: "btn #{params[:period].blank? ? 'btn-primary' : 'btn-outline-primary'}" %>
      </div>

      <%# Affichage des totaux à droite %>
      <div class="text-end">
        <span class="fw-bold"><%= @total_flights_count %></span> vols
        <span class="mx-2">|</span>
        <span class="fw-bold"><%= number_with_precision(@total_duration, precision: 2) %></span> h
      </div>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="table-responsive">
      <table class="table table-striped table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>Date</th>
            <th>Pilote</th>
            <th>Avion</th>
            <th>Trajet</th>
            <th class="text-end">Durée (centièmes)</th>
          </tr>
        </thead>
        <tbody>
          <% @vols.each do |vol| %>
            <tr>
              <td><%= l vol.debut_vol, format: :short_year %></td>
              <td><%= vol.user.name %></td>
              <td><%= vol.avion.immatriculation %></td>
              <td><%= vol.depart %> → <%= vol.arrivee %></td>
              <td class="text-end"><%= number_with_precision(vol.duree_vol, precision: 2) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <%# Liens de pagination Kaminari %>
  <div class="d-flex justify-content-center mt-4">
    <%= paginate @vols %>
  </div>
</div>
